// A simple document insert example, not using safe mode to ensure document persistance on MongoDB

var MongoClient = require('mongodb').MongoClient;
MongoClient.connect('mongodb://localhost:27017/test', function(err, db) {
  var collection = db.collection("user");
  // Insert a single document
  //var inserting = [{
  //  userid:"admin",
  //  username:"admin",
  //  password:"1",
  //  tempsocketid:""
  //},
  //{
  //  userid:"sunsiyuan",
  //  username:"孙思远",
  //  password:"1",
  //  tempsocketid:""
  //}
  //];
  //collection.insertMany(
  //  inserting
  //, function(err, result) {
  //  if (err) {throw err}
  //  console.log(result);
  //});

  //var query = {
  //  "userid":"sunsiyuan"
  //};
  //var suppression = {
  //  "msgs.admin":true
  //};
  //
  //collection.find(query,suppression).toArray(function (err,result) {
  //  if(err) throw err;
  //  console.log(result[0].msgs);
  //  //如果不存在该聊天纪录,创建
  //  db.close();
  //});

  //var selector = {
  //  "userid":"sunsiyuan"
  //};
  //var _admin ="admin";
  //var msgs = JSON.parse('{ "msgs.'+_admin+'" : "2" }');
  //var document = { $set: msgs };
  //var options = {
  //  'w':1
  //};
  //collection.update(selector,document,options, function (err, result) {
  //  if(err) throw err;
  //  console.log(result);
  //  //result
  //  // result: { ok: 1, nModified: 1, n: 1 },
  //  db.close();
  //});

});